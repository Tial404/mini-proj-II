---
title: "Mini Project III - Tial and Jessica"
format: pdf
editor_options: 
  chunk_output_type: console
---
```{r}
#load libraries for extracting inat data
library(tidyverse)
library(rinat)
```


```{r}
#extract raw data of all observations
raw_obs <- get_inat_obs_project("st-olaf-natural-lands", type = "observations")

#Created a new data frame called "obs_clean" from the previous data frame "raw_obs" which contains our raw data of observations. 
obs_clean <- raw_obs |>
  
#Using the select() function, we selected specific columns we want to include in our new data frame "obs_clean."
   select(observed_on, description, latitude, longitude, species_guess, user_id, created_at, updated_at,    place_guess, num_identification_agreements, num_identification_disagreements, quality_grade, uri, captive) |>
  
#We used the mutate() function to modify specific columns. 
#The ymd() function converts date columns to follow this format:  year-month-day 
#For the "created_at" and "updated_at" columns, we used the str_extract() function to isolate just the dates before reformatting it to years-month-day. 
#The parse_number() function extracts numeric values from "latitude" and "longitude" columns. 
#Finally, the replace_na() function for the "species_guess" column to replace any "NAs" with "unknown."
  
  mutate(observed_on = ymd(observed_on),
         latitude = parse_number(latitude), 
         longitude = parse_number(longitude),
         created_at = ymd(str_extract(created_at, "\\d{4}-\\d{2}-\\d{2}")),
         updated_at = ymd(str_extract(updated_at, "\\d{4}-\\d{2}-\\d{2}")),
         species_guess = replace_na(species_guess, "unknown"))|>
  
#Here, we used the rename() function to assign new names to specific columns. 
          rename (species = species_guess,
          location = place_guess, 
          quality = quality_grade,
          URL = uri,
          id_agreements = num_identification_agreements,
          id_disagreements = num_identification_disagreements) 
```

```{r}
#write_csv(obs_clean, "TJ_mini3")
```

Variable Description Table : 
The variable descriptions come from the iNaturalist website  [https://www.inaturalist.org/terminology#num_identification_agreements]

|variable name | data type | description |
|-------------|-------------|---------------------------------------------|
|observed_on  |Date  |The date of when the observation was made |
|description|Character |Comments/notes from the observer |
|latitude |Numeric |The latitude of the location where the observation was made |
|longitude |Numeric |The longitude of the location where the observation was made |
|species |Character |The name of the observed taxon |
|user_id |Integer |The identifier for the observer |
|created_at |Date |The date of when the observation was uploaded onto iNaturalist |
|updated_at |Date |The date of when the uploader updated their post |
|location |Character |The location of where the observation was made|
|id_agreements |Integer |The number of matching  identifications made by either the observer or community members|
|id_disagreements |Integer |The number of identifications  made by either the observer or community members that do not match |
|quality |Character |Observation grades based on accuracy, completeness, and relevance. The grades are separated into three categories: "needs ID," "casual," and "Research Grade." Observations are marked as “needs ID” if the community has not agreed on an identification, but the observation is verifiable. Observations are marked as “casual” if the observation is not verifiable, either due to missing or unreliable information. Observations are marked as “Research Grade” if the community agrees on the species identification. |
|URL |Character |The link/URL to the observation |
|captive |Logical |Uses “True” or “False” to indicate whether the observed organism was intentionally placed there by humans (true) or if it is a wild organism (false) |


We have also created a function that allows the user to choose a location and species which will output a cleaned dataset of all the observations of that species at that location. Example below searches for all observations of blue jays at St. Olaf College. 

```{r}
inat_observations <- function(location, species) { 
    raw_obs <- get_inat_obs_project(location, type = "observations")

  #Created a new data frame called "obs_clean" from the previous data frame "raw_obs" which contains our raw data of observations. 
    obs_clean <- raw_obs |>
  
  #Using the select() function, we selected specific columns we want to include in our new data frame "obs_clean."
    select(observed_on, description, latitude, longitude, species_guess, user_id, created_at, updated_at,    place_guess, num_identification_agreements, num_identification_disagreements, quality_grade, uri, captive) |>
  
#We used the mutate() function to modify specific columns. 
#The ymd() function converts date columns to follow this format:  year-month-day 
#For the "created_at" and "updated_at" columns, we used the str_extract() function to isolate just the dates before reformatting it to years-month-day. 
#The parse_number() function extracts numeric values from "latitude" and "longitude" columns. 
#Finally, the replace_na() function for the "species_guess" column to replace any "NAs" with "unknown."
  
  mutate(observed_on = ymd(observed_on),
         latitude = parse_number(latitude), 
         longitude = parse_number(longitude),
         created_at = ymd(str_extract(created_at, "\\d{4}-\\d{2}-\\d{2}")),
         updated_at = ymd(str_extract(updated_at, "\\d{4}-\\d{2}-\\d{2}")),
         species_guess = str_to_lower(replace_na(species_guess, "unknown")))|>
  
#Here, we used the rename() function to assign new names to specific columns. 
          rename(species = species_guess,
          location = place_guess, 
          quality = quality_grade,
          URL = uri,
          id_agreements = num_identification_agreements,
          id_disagreements = num_identification_disagreements) |>
      filter(species == {{species}})
    obs_clean
}
```

```{r}
inat_observations(location = "st-olaf-natural-lands", species = "blue jay")
```

With this dataset, we can explore things like the distribution of various species in the St. Olaf natural lends, trends over time in the frequency of both overall and per-species observations, and the most and least commonly observed species at St. Olaf. Because we have location data, this dataset is well suited for mapping, but counts and counts over time are also interesting observations. We can additionally explore trends in how iNaturalist is used at St. Olaf, including the quality of observations and how reliable they are based on verification or lack thereof. 
