---
title: "Nature of St. Olaf"
output: flexdashboard::flex_dashboard
runtime: shiny
---

```{r global, include=FALSE}
#libraries and data to read in
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(AER)
library(tidyverse)
library(rinat)
library(dplyr)
library(lubridate)
library(readr)
inat_stolaf <- read_csv("inat_with_invasives.csv")
```

About
==========================

Column 
-------------------------

**Introduction**

This project will investigate which species are most frequently reported at St. Olaf College, providing insight into their distribution across campus. Our goal is to better understand the biodiversity present at St. Olaf and how students interact with it. We aim to analyze how often students encounter particular species by location, month, and year. Additionally, we will examine which species are most commonly identified and assess how many of these are native versus invasive.

To summarize, the questions we want to answer are: 
What species are most frequently observed by students and faculty at St Olaf College?
How frequently are these species observed and identified ?
When and where are these species being observed ?
How many invasive species are identified at St Olaf College?
How many native species are identified at St Olaf College?

All of our data are extracted from the iNaturalist St. Olaf project, which relies on individuals to report their observations. As a result, some species that are abundant at St. Olaf may not appear in our analysis due to a lack of student submitted observations. Therefore, this project provides a general overview rather than a complete or fully accurate representation of species abundance on campus.

**Important Links** 

Here is the link for our iNaturalist Dataset : (https://www.inaturalist.org/observations?project_id=st-olaf-natural-lands&place_id=any&verifiable=any) 

Here is the link from Minnesota DNR webpage  : (https://www.dnr.state.mn.us/invasives/terrestrialplants/index.html)

**Link to our code!**

https://github.com/Tial404/mini-proj-II.git

Column 
-------------------------

```{r, echo=FALSE}

renderImage({
    # renders the image
    list(src = "natlands.png",
         alt = "This is alternate text", width = 500, height = 700)
  })
```

Observation Locations
==========================
**Mapping observations**

This leaflet map shows the distribution of the observations we use for this project. They are spread across the St. Olaf Natural Lands, unsurprisingly often close to trails. 

```{r, echo=FALSE, warning=FALSE}
#find unique data points
unique_coords <- unique(inat_stolaf[c("latitude", "longitude")])

library(leaflet)  
 #add points to leaflet plot
leaflet() |>
  addTiles() |>
  setView(lng = mean(unique_coords$longitude), 
          lat = mean(unique_coords$latitude), 
          zoom = 13) |> 
  addCircleMarkers(data = unique_coords,
    lat = ~latitude, 
    lng = ~longitude, 
    popup = "Observation Location",  
    radius = 2,
    weight = 2,
    color = "purple", 
    fillColor = "purple")

```

Common Species
========================================
Column {data-width=300}
-------------------------------------

**Common Species**

Creating a bar chart allows us to clearly visualize the most common species, making it easy to compare their relative frequencies. We see that there is a mixture of both plants and animals reported. The quality grade helps us see which reports may be less reliable, with "research" indicating a high level of accuracy, while "needs id" tells us that the observation may be incorrect or too general. For example, "dicots" is a broad category of plants, so many observations are labeled as such because they could not be identified to the species level. "Casual" indicates that there is some missing information in the report, such as data, location, or clear evidence of the species. 

```{r, echo=FALSE, warning=FALSE}
inputPanel(
  radioButtons(
    "top_num",
    label = h3("Top"),
    choices = c(5, 10, 15, 20, 25, 30),
    selected = 5
  )
) #set radio buttons

renderPlot({

  top_num <- inat_stolaf |>
    drop_na(species_guess) |>
    count(species_guess, sort = TRUE) |>
    slice(1:as.numeric(input$top_num)) #filter only top species

  top_num_joined <- top_num |>
    left_join(inat_stolaf, by = "species_guess")

  ggplot(top_num_joined, aes(x = species_guess, fill = quality_grade)) +
    geom_bar(position = "stack") +
    theme_minimal() +
    theme(
      axis.text.x = element_text(angle = 45, hjust = 1),
      panel.grid.minor = element_line(color = "grey90")
    ) +
    labs(
      title = "Frequency of species observed and identified",
      subtitle = "Based on Quality Grade",
      x = "Species",
      y = "Number of observations"
    ) +
    scale_fill_viridis_d(option = "mako")
})


```

Column {data-width=600}
-------------------------------------
**Observations throughout the year**

Creating a scatterplot to visualize which species students encounter and the frequency of occurrence can provide valuable insight into species distribution throughout the year. This approach helps reveal patterns over time, such as seasonal trends or periods of higher biodiversity, making the data easier to interpret and compare.

```{r,echo=FALSE}
inputPanel(
  checkboxGroupInput("checkGroup", label = h3("Years"), 
    choices = list("2010", "2011","2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022", "2023", "2024", "2025"),
    selected = "2025"),
 ) #checkbox

renderPlot({
  toptwentyfive <- inat_stolaf |>
  drop_na(species_guess) |>
  count(species_guess, sort = TRUE) |>
  slice(1:25)
  
    inat_stolaf2 <- inat_stolaf |>
    mutate(observed_on = ymd(observed_on),
           year = year(observed_on)) |> 

    inner_join(toptwentyfive, by = join_by(species_guess)) |>
    filter(year %in% as.numeric(input$checkGroup)) |>
    group_by(species_guess, year, .drop = FALSE) |>
    summarise(count = n())


  ggplot(inat_stolaf2, 
         aes(x = year, y = count, color = species_guess, group = species_guess)) +
  geom_point() +
  geom_line() +
  labs(x = "year",
       y = "Num. Observations",
       color = "Species") +
        theme(axis.text = element_text(size = 18)) +
        theme(axis.title = element_text(size = 20)) +
        theme(plot.title = element_text(size=22)) +
  scale_x_continuous(breaks = ~ axisTicks(., log = FALSE)) +
    theme_bw()
})
```


Invasive vs Native Species
========================================

Column {data-width = 300}
-------------------------

**Invasive Species**


In a given area, invasive species are those non-native species that actively cause harm to the ecosystem in some way. Often, this is due to outcompeting native species, causing them to be close to or at extinction. This in turn reduces biodiversity in an area and may have a cascading effect across the entire ecosystem. One common example is common buckthorn, a tree native to Eurasia that spreads rapidly in North American ecosystems and dominates, crowding out native species. It also includes species that are harmful to humans, such as wild parsnip, a plant that spreads rapidly once in large numbers and causes chemical burns to people who touch its sap.   
The control of invasive species is more difficult than ever due to the global connectivity of the planet, so tracking the presence of invasive species and removing them is a primary goal of conservation efforts. We used information from the Minnesota DNR to determine how many observations of invasive species occured at St. Olaf on iNaturalist. 

```{r, echo = FALSE, warning = FALSE}
invasives <- inat_stolaf |>
  filter(native == "invasive") #pull out just invasive species observations
```

```{r, echo = FALSE, warning = FALSE}
invasives |>
  group_by(species_guess) |>
  summarise(count = n()) |>
  mutate(species_guess = fct_reorder(species_guess, count)) |>
  ggplot(aes(x = species_guess, y = count)) +
  geom_col() +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),  
        panel.grid.minor = element_line(color = "grey90")) +
  labs(x = "Species", y = "Num. Observations",
       title = "Invasive Species Observations of St. Olaf") 
```

Column {data-width = 600}
-------------------------

**Invasive Domination?**

Invasive species are a serious threat, and there are many instances where they seem to completely dominate an ecosystem. For example, in the southern USA, kudzu vines are often observed completely strangling massive patches of forest along roadsides. In the eastern USA, spotted lanternflies come out in masses each year despite being crushed by the dozens. At the same time, efforts are continually being made by conservationists to beat them back and prevent encroachment in addition to pulling out what has already invaded. The raw numbers may seem scary, but in comparison to the amount of native species, the story at St. Olaf is a little more heartening. 

```{r, echo = FALSE, warning = FALSE}
inputPanel(
  radioButtons("radio", label = h3("y-axis"),
    choices = list("Num. Invasives" = "num_invasive", "Prop. Invasives" = "prop_invasive"), 
    selected = "Num. Invasives"),
)

renderPlot({
  inat_stolaf |>
  mutate(year_obs = year(observed_on)) |>
  group_by(year_obs) |>
  summarise(total = n(),
            num_invasive = sum(native=="invasive", na.rm = TRUE),
            prop_invasive = num_invasive/total) |>
  pivot_longer(c(num_invasive, prop_invasive), names_to = "type",
               values_to = "invasive_obs") |>
  filter(type == input$radio) |>
  ggplot(aes(x = year_obs, y = invasive_obs)) +
  geom_point() +
  labs(x = "Year", y = "Invasive Observations", title = "Invasive Species Observations Over Time at St. Olaf")  +
    theme_bw()
}, height = 500)
```

Seasonal Shifts
========================================

Column {data-width = 400}
-------------------------

**Seasonal Effects at St. Olaf**

Almost every species is affected by the seasons in some way. Some have very seasonal life cycles, like most insects that only move around in the warm months, or plants that die back in the winter. Trees remain, but without their most identifying features, and animals tend to become far less active. Few species are more active in the winter, but there are exceptions, such as migratory birds like the dark-eyed juncos, which are typically only seen in Minnesota in wintertime. The people of St. Olaf, too, are less active, hiding away from the cold. Thus, we may expect to see interesting seasonal changes in iNaturalist observations due to shifts in both human and non-human activity.

```{r, echo=FALSE}
inputPanel(
  checkboxGroupInput("checkGroup", label = h3("Species"), 
    choices = list("bloodroot", "virginia waterleaf","black-capped chickadee", "jack-in-the-pulpit", "american toad", "sugar maple", "white-faced meadowhawk", "american crow", "common green darner", "downy woodpecker"),
    selected = "bloodroot"),
)

renderPlot({
  topten <- inat_stolaf |>
  drop_na(species_guess) |>
  count(species_guess, sort = TRUE) |>
  filter(species_guess != "dicots") |>
  slice(1:10) 

inat_stolaf |>
  filter(!is.na(observed_on)) |>
  mutate(season = ifelse(month(observed_on) %in% c(12, 1, 2), "Winter", 
                         ifelse(month(observed_on) %in% c(3,4,5), "Spring",
                                ifelse(month(observed_on) %in% c(6,7,8), "Summer", "Fall"))),
         season = fct_relevel(season, "Winter", "Spring", "Summer", "Fall")) |>
  inner_join(topten, by = join_by(species_guess)) |>
  filter(species_guess %in% input$checkGroup) |>
  group_by(species_guess, season, .drop = FALSE) |>
  summarise(count = n())|>
  ggplot(aes(x = season, y = count, color = species_guess, group = species_guess)) +
  geom_point() +
  geom_line() +
  labs(x = "Season",
       y = "Num. Observations",
       color = "Species")  +
    theme_bw()
}, height = 500)
```

Column {data-width = 400}
-------------------------

**The Benefits of Winter**

The famous cold of a Minnesota winter may have its benefits in the ecosystem. Despite its challenges, the native species of Minnesota have adapted to survive and even thrive. Non-native species, on the other hand, have only just begun to face its wrath. Thus, one potential limiting factor to be explored is the prevalence of invasive species across seasons, which could be key to holding them off. 

```{r, echo=FALSE}
inputPanel(
  selectInput("select", label = h3("Season"), 
    choices = list("Winter", "Spring", "Summer", "Fall"), 
    selected = "Winter")
)

renderPlot({
  inat_stolaf |>
  filter(!is.na(observed_on)) |>
  mutate(season = ifelse(month(observed_on) %in% c(12, 1, 2), "Winter", 
                         ifelse(month(observed_on) %in% c(3,4,5), "Spring",
                                ifelse(month(observed_on) %in% c(6,7,8), "Summer", "Fall"))),
         season = fct_relevel(season, "Winter", "Spring", "Summer", "Fall"),
         native = replace_na(native, "non-invasive"),
         year_obs = year(observed_on)) |>
  group_by(native, season, year_obs, .drop = FALSE) |>
  summarise(count = n()) |>
  filter(season == input$select) |>
  ggplot(aes(x = native, y = count)) +
  geom_boxplot()  +
    theme_bw()
}, height = 500)
```

Conclusions and Future Works
========================================

**Conclusions**

The St. Olaf Natural Lands iNaturalist data reveals some impressive trends with regards to the species observed over the years. We find that there is significant biodiveristy across the entirety of the Natural Lands, including many different plants and animals. Observations have generally increased over the years, possibly due to greater conservation efforts and more usage of the Natural Lands and iNaturalist by students. In addition, we find an impressively low number of invasive species in the Natural Lands, again supporting the conservation efforts in recent years to preserve and protect native species. Our data can also be used to explore seasonal trends for various species, revealing valuable information about their life histories and behavior. 


**Limitations**

The primary limitation to our data is the information we have on invasive species. Due to small differences in the naming conventions of species on iNaturalist and the Minnesota DNR website, it is likely that some observations of invasive species were not flagged as such when merging the data. Human behavior also plays a role in the invasive species data on iNaturalist, as people are likely to underreport invasive species due to them being less interesting than the native species found in the area. Thus, our analysis on invasive species comes with the caution that the true abundance of invasive species in the Natural Lands is likely higher. Rare species are also likely overrepresented in the data, again because it is a more interesting to most people to report a rare species seen once rather than the same common species twenty times. 

**Future Directions** 

One step we would like to take with this project in the future is categorizing our results by broader groups of organisms, such as animals vs plants or birds vs mammals. Since many individual species only have a handful of observations, combining related species would allow us to see broader trends affecting these groups. For example, we could observe how plant observations vary seasonally compared to birds and insects.   

We would also liked to have looked deeper into the data on descriptions of observations provided by iNaturalist. With text analysis, we could examine the tone of these descriptions compared to the species, which may reveal animosity towards certain groups, such as invasive species, versus a potentially more positive tone towards rare or beautiful species.